{% extends "layout.html" %}



{% block title %}

<div class="header-content" data-0="height:175px" data-150="height:0px">
    <div class="top-header">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12">
                    <h1 data-0="margin-top:80px;font-size: 3.5em;" data-150="margin-top:-55px;font-size: 2em;">
                      Upload a bundle
                    </h1>
                </div>
                
            </div>
        </div>
    </div>

</div>


{% endblock %}


{% block subtitle %}

<div class="bottom-header">
    <div class="navbar navbar-default">
        <div class="navbar-collapse collapse navbar-responsive-collapse-filter">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <a href="/plugins"><i class="fa fa-angle-left"></i> Back to all plugins</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

{% endblock %}



{% block content %}

{% if uploaded == None  %}
    <div class="main-content">
      <div class="container-fluid">
        <form id='metaBundle'>
          <input type='text' id="bundleName" required placeholder='name'>
          <input type='text' id="bundleDescription" required placeholder='description'>
          <input type='submit' value = 'Go' id="createBundle">
        </form>
      </div>
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12">
                    <div id="droparea" class="dropzone">
                        <h1>Click or drag a bundle folder</h1>
                        <div id="previewsContainer">
                        </div>
                    </div>
                </div>
            </div>

            <!-- <div id="selectImage"><a href="#">Select folder</a></div> -->
            <!-- <div id="fileSubmit"><a href="" class="btn btn-primary">Upload bundle</a></div> -->
            <div id="fileSubmit"><btn class="btn btn-primary">Upload bundle</btn></div>
        </div>
    </div>

{% else %}

    <div class="main-content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12">
                    LOL
                </div>
            </div>
        </div>
    </div>

{% endif %}


<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="{{ url_for('static', filename='scripts/vendor/dropzone.js') }}"></script>
<script type="text/javascript">
var bundleId = undefined;
//var bundleId;
console.log("START : bundleId : "+bundleId);

var myDropzone = undefined;
$("#droparea").hide();
$('#fileSubmit').hide();


$(function(){
var wofxDropzone = new Dropzone("#droparea", {
    url: "undefinedUrl",
    acceptedFiles: "application/zip, application/x-tar, application/gzip, application/x-gzip", //This is a comma separated list of mime types or file extensions.Eg.: image/*,application/pdf,.psd.
    maxFilesize: 1024, // in MB
    paramName: "file" // The name that will be used to transfer the file
} );

wofxDropzone.options.previewTemplate = '\
    <div class="dz-preview dz-file-preview">\
      <div class="dz-details">\
      <div class="dz-filename"><span data-dz-name></span></div>\
      <div class="dz-size" data-dz-size></div>\
      <img data-dz-thumbnail />\
    </div>\
    <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\
    <div class="dz-error-message"><span data-dz-errormessage></span></div>\
    </div>';

$('#fileSubmit').click(function(){
  console.log("upload to :" + wofxDropzone.options.url);
  console.log(wofxDropzone);

  wofxDropzone.options.headers={"Content-Type": wofxDropzone.files[0].type};
  wofxDropzone.processQueue(); //processes the queue
});

$('#metaBundle').submit(function(event, bundleId){
    console.log("submit");
    bundleName = $("#bundleName").val();
    bundleDescription = $("#bundleDescription").val();
    console.log(bundleDescription);

    $.ajax({
        type : 'POST',
        url : '/bundle',
        data : {'bundleName' : bundleName, 'bundleDescription' : bundleDescription}
    }).done(function(data, bundleId){
        $("#droparea").show();
        console.log("DROPZONE IS READY, BUNDLEID IS GENERATED !")

        jsonData = JSON.parse(data);
        bundleId = jsonData.b[0].bundleId;
        console.log("MIDDLE : "+bundleId);

        var bundleURI = "/bundle/"+bundleId+"/upload";

        wofxDropzone.options.url = bundleURI;

        $('#fileSubmit').show();
        // dict[url] = "/file/post";
        // $("div#myId").dropzone(dict);
  });

  console.log("END : bundleId : "+bundleId);
  console.log("---------------------------------");
  event.preventDefault();

});


});



// $(function(){
//     $('#droparea h1').show();

//     // $(" #fileSubmit a").click(function(){
//     //     return false;
//     // });
//     var megaUrl;
//     if(bundleId != undefined){
//         console.log("bundleID exsite");
//         megaUrl = "/bundle/"+bundleId+"/upload";
//     }else{
//         console.log("bundleID n'exite pas");
//         megaUrl = "/bundle/upload";
//     }


//     console.log("in function : bundleId : "+bundleId);
//     myDropzone = new Dropzone(
//       "#droparea",
//       {
//         url: megaUrl,
//         method: "post", // can be changed to "put" if necessary
//         maxFilesize: 1024, // in MB
//         paramName: "file", // The name that will be used to transfer the file
//         uploadMultiple: true, // This option will also trigger additional events (like processingmultiple).
//         headers: {
//           "My-Awesome-Header": "header value"
//         },
//         addRemoveLinks: true, // add an <a class="dz-remove">Remove file</a> element to the file preview that will remove the file, and it will change to Cancel upload
//         previewsContainer: "#previewsContainer",
//         // clickable: "#droparea",
//         clickable: true,
//         createImageThumbnails: true,
//         maxThumbnailFilesize: 200, // in MB
//         thumbnailWidth: 300,
//         thumbnailHeight: 300,
//         maxFiles: 3000,
//         acceptedFiles: "image/png, image/jpg, image/jpeg, image/gif, video/mp4, video/avi, application/zip, application/tar.gz, application/x-tar, application/x-gzip", //This is a comma separated list of mime types or file extensions.Eg.: image/*,application/pdf,.psd.
//         autoProcessQueue: false, // When set to false you have to call myDropzone.processQueue() yourself in order to upload the dropped files. 
//         forceFallback: false,

//         init: function() {
//           // console.log("init");
//         },
//         resize: function(file) {
//           // console.log("resize");
//           /*
//            * Crop rectangle range
//            * Those values are going to be used by ctx.drawImage().
//            */ 
//           return {"srcX":0, "srcY":0, "srcWidth":300, "srcHeight":300}
//         },
//         accept: function(file, done) {
//           // console.log("accept");
//           console.log(done);
//           done();
//         },
//         fallback: function() {
//           // console.log("fallback");
//         }
//       });
//     console.log(myDropzone);
//     myDropzone.autoDiscover = false;
//     myDropzone.options.previewTemplate = '\
//     <div class="dz-preview dz-file-preview">\
//       <div class="dz-details">\
//       <div class="dz-filename"><span data-dz-name></span></div>\
//       <div class="dz-size" data-dz-size></div>\
//       <img data-dz-thumbnail />\
//     </div>\
//     <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\
//     <div class="dz-error-message"><span data-dz-errormessage></span></div>\
//     </div>';


//   /* receive the "file" as first parameter */
//   myDropzone.on("addedfile", function(file) {
//     // console.log("addedfile");
//     // console.log(file);
//     $('#fileSubmit').show();
//     $('#droparea h1').hide();
//   });
//   myDropzone.on("removedfile", function(file) { 
//     //console.log("removedfile"); 
//     if (file = null) {
//       $('#droparea h1').show();
//     };
//   });
//   return myDropzone;
// });

console.log("kakakakakakakme");
console.log(myDropzone);


</script>

{% endblock %}



